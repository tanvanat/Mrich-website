// /lib/questions.ts
export const FORM_ID = "mrich-amway-h7-v1";

export type Question = {
  id: string;
  category: string;
  q: string;

  // scoring rules (auto)
  minChars?: number;     // ต้องพิมพ์อย่างน้อยกี่ตัวอักษร
  minItems?: number;     // ต้องตอบเป็น "อย่างน้อย N ข้อ" (นับจากบรรทัด/เลข/จุด/คอมม่า)
  hint?: string;
};

export const questions: Question[] = [
  {
    id: "q1",
    category: "กรอบความคิดและภาพรวมนิสัยทั้ง7",
    q: "1. ชีวิตเราจะสุขจะทุกข์ จะรวยจะจน จะมีความสัมพันธ์ที่ดีหรือไม่ดี อยู่ที่อะไร?",
    minChars: 30,
    hint: "ตอบเป็นประโยค/ย่อหน้าได้",
  },
  {
    id: "q2",
    category: "กรอบความคิดและภาพรวมนิสัยทั้ง7",
    q: "2. ทำไมเราควรทำให้ทุกวันของชีวิตมีความหมาย ส่งผลดีกับชีวิตเรายังไง? (บอกมาอย่างน้อย 3 อย่าง)",
    minItems: 3,
    minChars: 60,
    hint: "แนะนำให้พิมพ์เป็นข้อ ๆ อย่างน้อย 3 ข้อ",
  },
  {
    id: "q3",
    category: "กรอบความคิดและภาพรวมนิสัยทั้ง7",
    q: "3. ในเงินสี่ด้าน (ESBI) ทำไมเราต้องสร้างรายได้ทั้ง 2 ฝั่ง (ซ้ายและขวา) ถ้าสร้างฝั่งใดฝั่งหนึ่งอย่างเดียว ส่งผลเสียกับชีวิตเรายังไง? (บอกมาอย่างน้อย 3 ข้อ)",
    minItems: 3,
    minChars: 80,
  },
  {
    id: "q4",
    category: "กรอบความคิดและภาพรวมนิสัยทั้ง7",
    q: "4. จะสำเร็จในแอมเวย์ที่เป็น Business Owner ได้ ต้องมีนิสัยอะไร?",
    minChars: 30,
  },
  {
    id: "q5",
    category: "กรอบความคิดและภาพรวมนิสัยทั้ง7",
    q: "5. ถ้าต้องการเปลี่ยนแปลงชีวิต กระดุมเม็ดแรกที่ต้องเปลี่ยนคืออะไร? เพราะอะไร?",
    minChars: 60,
  },
  {
    id: "q6",
    category: "กรอบความคิดและภาพรวมนิสัยทั้ง7",
    q: "6. กระดุมเม็ดแรกของการเปลี่ยนนิสัยมีองค์ประกอบอะไรบ้าง?",
    minItems: 2,
    minChars: 40,
  },
  { id: "q7", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "7. การสร้างชีวิตมี 2 แบบคืออะไร?", minItems: 2, minChars: 20 },
  { id: "q8", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "8. ความรู้เรื่องเลนส์คนละสี ผู้เขียนต้องการให้เรารู้อะไร?", minChars: 40 },
  { id: "q9", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "9. ภาพหญิงสาวกับหญิงชรา ผู้เขียนต้องการให้เรารู้อะไร?", minChars: 40 },
  { id: "q10", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "10. คนฉลาดกับคนมีปัญญาต่างกันอย่างไร?", minChars: 40 },
  { id: "q11", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "11. ทำไมบางคนมีความรู้มากมายแต่ยังเอาตัวไม่รอด?", minChars: 40 },
  {
    id: "q12",
    category: "กรอบความคิดและภาพรวมนิสัยทั้ง7",
    q: '12. "หลักการ" คืออะไร? สำคัญกับชีวิตอย่างไร? (บอกมาอย่างน้อย 3 อย่าง)',
    minItems: 3,
    minChars: 70,
  },
  { id: "q13", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: '13. "ยิ่งให้ ยิ่งได้รับ" คือเราควรให้อะไร? แล้วสิ่งที่ได้รับคืออะไร?', minChars: 50 },
  {
    id: "q14",
    category: "กรอบความคิดและภาพรวมนิสัยทั้ง7",
    q: "14. เงิน, เวลา, ความสัมพันธ์ จัดเรียงความสำคัญอย่างไร จากมีค่ามากสุดไปน้อยสุด?",
    minItems: 3,
    minChars: 20,
    hint: "พิมพ์เรียงลำดับ เช่น 1) ... 2) ... 3) ...",
  },
  { id: "q15", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: '15. "หลักการ" ของการสร้างการเจริญเติบโตและการเปลี่ยนแปลงคืออะไร?', minChars: 40 },
  { id: "q16", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "16. 5 ลำดับขั้นของการสร้างชีวิตให้มีความหมายมีอะไรบ้าง?", minItems: 5, minChars: 40 },
  { id: "q17", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "17. หลักการที่ใช้ในการมองปัญหาคืออะไร?", minChars: 30 },
  { id: "q18", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "18. เราควรแก้ปัญหาในเรื่องใดบ้าง (บอกมาอย่างน้อย 3 อย่าง)", minItems: 3, minChars: 40 },
  { id: "q19", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "19. หลักการแก้ปัญหา ต้องไปแก้ตรงไหน?", minChars: 30 },
  { id: "q20", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "20. องค์ประกอบของนิสัยมีอะไรบ้าง?", minItems: 2, minChars: 20 },
  { id: "q21", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "21. วัยเด็ก (วัยพึ่งพาผู้อื่น) ต้องได้นิสัยอะไรมา? ถึงจะเติบโตเป็นผู้ใหญ่ที่ดี", minChars: 40 },
  { id: "q22", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "22. ความเป็นผู้ใหญ่จริงๆ วัดกันตรงไหน?", minChars: 40 },
  { id: "q23", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "23. จะสร้างชีวิตที่มีความหมายได้ เราต้องมีนิสัยอะไร?", minChars: 40 },
  { id: "q24", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "24. ทำไมต้องสร้างสมดุลระหว่าง P/PC ?", minChars: 40 },
  { id: "q25", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "25. การสร้าง PC คือทำอะไรบ้าง?", minItems: 2, minChars: 30 },
  { id: "q26", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "26. สินทรัพย์สำคัญที่เราต้องสะสมให้มากมีกี่อย่าง อะไรบ้าง?", minItems: 2, minChars: 30 },
  { id: "q27", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "27. จัดเรียงลำดับความสำคัญของสินทรัพย์จากมากสุดไปน้อยสุด", minItems: 2, minChars: 20 },
  { id: "q28", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "28. การสร้างนิสัยให้เห็นคุณค่าในสิ่งที่มีอยู่ ในชั้นที่ 2.1 คือทำอะไร?", minChars: 40 },
  { id: "q29", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "29. เราจะรู้สึกถึงความมั่นคงปลอดภัยในชีวิต เมื่อเราทำอะไรได้?", minChars: 40 },
  { id: "q30", category: "กรอบความคิดและภาพรวมนิสัยทั้ง7", q: "30. จุดสูงสุดของการสร้างชีวิตให้มีความหมายคือทำอะไร?", minChars: 40 },
];

// ✅ คะแนนเต็ม (ข้อละ 1 คะแนน)
export const maxTotal = questions.length;

// ---- helpers (auto-check) ----
function normalize(s: string) {
  return (s ?? "").replace(/\r/g, "").trim();
}

export function countItems(answer: string) {
  const s = normalize(answer);
  if (!s) return 0;

  // นับจากบรรทัด + bullet/ตัวเลข/คอมม่า
  const lines = s
    .split("\n")
    .map((x) => x.trim())
    .filter(Boolean);

  // ถ้าเขียนเป็นบรรทัดอยู่แล้ว นับจากบรรทัดก่อน
  const byLines = lines.length;

  // fallback: split ด้วยคอมม่า/เซมิโคลอน/•/-
  const bySep = s
    .split(/[,;•]/)
    .map((x) => x.trim())
    .filter(Boolean).length;

  // ถ้าใช้ 1) 2) 3) ในบรรทัดเดียว
  const byNumbered = (s.match(/(^|\s)\d+[\)\.]/g) ?? []).length;

  return Math.max(byLines, bySep, byNumbered);
}

export function scoreAnswer(q: Question, answer: string) {
  const s = normalize(answer);
  if (!s) return 0;

  if (q.minChars && s.length < q.minChars) return 0;
  if (q.minItems && countItems(s) < q.minItems) return 0;

  return 1;
}

export function levelFromPercent(pct: number) {
  // เงื่อนไขตามโจทย์
  if (pct === 100) return { level: "LEAD", tip: "ทำได้เต็ม 100% ✅ ได้ลีด" };
  if (pct >= 80) return { level: "PASS", tip: "ทำได้เกิน 80% ✅ ได้เรียนต่อ" };
  return { level: "REPEAT", tip: "ทำได้น้อยกว่า 79% ❌ เรียนซ้ำ" };
}

// กำหนดเวลาข้อสอบ (นาที)
export const EXAM_MINUTES = 30;
